var AddProductToCart=function(n){for(var t in n)this[t]=n[t];return this.Initialize(n)};AddProductToCart.prototype={Initialize:function(){this.RegisterEvent()},RegisterEvent:function(){$('td[name="td-quantity"] .quantity-up').unbind("click").click(function(){let n=$(this).closest("tr").data("id");Common.ShowLoading(!0);Common.AddProductToCart.UpdateOrderCart(n,"T",this)});$('td[name="td-quantity"] .quantity-down').unbind("click").click(function(){let n=$(this).closest("tr").data("id"),t=$('input[name="Quantity-'+n+'"]');if(t&&t.val()===1)return toastr.error("Số lượng sản phẩm phải lớn hơn 0.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0}),!1;Common.ShowLoading(!0);Common.AddProductToCart.UpdateOrderCart(n,"G",this)});$(".quantity-txt").unbind("change").change(function(){let n=$(this),t=$(this).closest("tr").data("id");if(n&&n.val()<=0)return toastr.error("Số lượng sản phẩm phải lớn hơn 0.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0}),!1;Common.ShowLoading(!0);var i=$(this).data("value");Common.AddProductToCart.UpdateOrderCart(t,"C",this,n.val()-i);$(this).data("value",n.val())});document.querySelectorAll(".quantity-txt").forEach(function(n){let t=function(){this.value=this.value.replace(/[^+\d]/g,"")};n.removeEventListener("input",t);n.addEventListener("input",t)});$(".buyAdd").unbind("click").click(function(){let n=$(this).data("id");Common.ShowLoading(!0);Common.Ajax({url:Common.AddProductToCart.Url.AddItemToCartByProductID,type:"POST",ContentType:"application/json; charset=utf-8",async:!1,cache:!1,dataType:"JSON",data:{productId:n}},function(n){var r,i,t,u;if(Common.ShowLoading(!1),!Common.Empty(n))if(n.status===!0){for(r=n.cookieid,Common.createCookie("orderCart",n.cookieid,1),i=0,t=0,u=n.data.length;t<u;t++)i+=n.data[t].Quantity||0;Common.createCookie(r,n.data?i:"0",1);toastr.success("Thêm vào giỏ hàng thành công.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0});window.location.href=Common.AddProductToCart.Url.CartIndex}else toastr.error("Thêm vào giỏ hàng thất bại.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0})})});$(".deleteOrder").unbind("click").click(function(){let n=$(this).attr("data-id"),t=$(this).attr("data-cartId");Common.ShowLoading(!0);Common.Ajax({url:Common.AddProductToCart.Url.DeleteItemToCartByProductID,type:"POST",ContentType:"application/json; charset=utf-8",async:!1,cache:!1,dataType:"JSON",data:{productId:n,cartId:t}},function(n){var r,i,t,u;if(Common.ShowLoading(!1),!Common.Empty(n))if(n.status===!0){for(r=n.cookieid,Common.createCookie("orderCart",n.cookieid,1),i=0,t=0,u=n.data.length;t<u;t++)i+=n.data[t].Quantity||0;Common.createCookie(r,n.data?i:"0",1);toastr.success("Cập nhật giỏ hàng thành công!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0});setTimeout(()=>{window.location.reload()},2e3)}else toastr.error("Cập nhật giỏ hàng thất bại.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0})})})},AddToCart:function(n){let t=$(n).data("id");Common.ShowLoading(!0);Common.Ajax({url:Common.AddProductToCart.Url.AddItemToCartByProductID,type:"POST",ContentType:"application/json; charset=utf-8",async:!1,cache:!1,dataType:"JSON",data:{productId:t}},function(n){var r,i,t,u;if(Common.ShowLoading(!1),!Common.Empty(n))if(n.status===!0){for(r=n.cookieid,Common.createCookie("orderCart",n.cookieid,1),i=0,t=0,u=n.data.length;t<u;t++)i+=n.data[t].Quantity||0;Common.createCookie(r,n.data?i:"0",1);toastr.success("Thêm vào giỏ hàng thành công.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0});window.location.href=Common.AddProductToCart.Url.CartIndex}else toastr.error("Thêm vào giỏ hàng thất bại.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0})})},UpdateOrderCart:function(n,t,i,r){Common.Ajax({url:Common.AddProductToCart.Url.AddItemToCartByProductID,type:"POST",ContentType:"application/json; charset=utf-8",async:!1,cache:!1,dataType:"JSON",data:{productId:n,flag:t,val:r}},function(t){var o,f,r,s,u,e;if(Common.ShowLoading(!1),!Common.Empty(t))if(t.status===!0){for(o=t.cookieid,Common.createCookie("orderCart",t.cookieid,1),f=0,r=0,s=t.data.length;r<s;r++)f+=t.data[r].Quantity||0;Common.createCookie(o,t.data?f:"0",1);u=t.data.filter(t=>t.ProductId===n);u[0].Price===0?$(i).closest("tr").find(".priceTotalItem").text("Liên hệ"):$(i).closest("tr").find(".priceTotalItem").text(u[0].TotalPriceItemStr);$(i).closest("tr").find('input[name="Quantity-'+n+'"]').val(u[0].Quantity);e=Common.SumTotal(t.data,"TotalPriceItem");e>0?$(".priceTotal").text(e.toLocaleString("en-US").replace(/,/g,".")+"đ"):$(".priceTotal").text("Liên hệ");toastr.success("Cập nhật giỏ hàng thành công!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0});Common.ShowLoading(!1);countOrder("orderCart")}else toastr.error("Cập nhật giỏ hàng thất bại.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0}),Common.ShowLoading(!1)})}};