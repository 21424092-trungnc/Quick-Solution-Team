var CartAdd=function(n){for(var t in n)this[t]=n[t];return this.Initialize(n)};CartAdd.prototype={Initialize:function(){this.RegisterEvent()},RegisterEvent:function(){$("#btnSaveCart").unbind("click").click(function(){if(Common.CartAdd.validatorForm("#form-CartAdd"),$("#form-CartAdd").find(".field-validation-error").length===0){var n=$("#form-CartAdd").serialize();Common.ShowLoading(!0);Common.Ajax({url:Common.CartAdd.Url.AddItemToCart,type:"POST",ContentType:"application/json; charset=utf-8",async:!1,cache:!1,dataType:"JSON",data:n},function(n){if(Common.ShowLoading(!1),!Common.Empty(n))if(n.status===!0){var t=n.data[0].CookieId;Common.createCookie("orderCart",n.data[0].CookieId,1);Common.createCookie(t,JSON.stringify(n.data),1);toastr.success("Thêm vào giỏ hàng thành công.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0});window.location.href=Common.CartAdd.Url.CartIndex}else toastr.error("Thêm vào giỏ hàng thất bại.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0})})}return!1});$("#btnOfferCart").unbind("click").click(function(){$("#modalPromotion").modal("show")});$("#SaveCartPromotion").unbind("click").click(function(){var i=[],r,n,t;return $('#modalPromotion tr[name="item"]').each(function(){let n=$(this).find("input");n.is(":checked")&&(console.log(n.val()),i.push({PromotionId:n.attr("data-promotionid"),promotionofferid:n.attr("data-promotionofferid"),ProductGiftsId:n.attr("data-productgiftsid"),ProductId:n.attr("data-productid"),DisCountValue:n.attr("data-discountvalue")}))}),Common.CartAdd.validatorForm("#form-CartAdd"),$("#form-CartAdd").find(".field-validation-error").length===0&&(r=$("#form-CartAdd").serializeArray(),n={},r.forEach(function(t){t.name.indexOf(".")>-1?n[t.name.split(".")[1]]=t.value:n[t.name]=t.value}),t=new FormData,t.append("dataModel",JSON.stringify(n)),t.append("CartPromotion",JSON.stringify(i)),Common.ShowLoading(!0),$.ajax({type:"POST",contentType:!1,processData:!1,url:Common.CartAdd.Url.AddItemToCartPromotion,data:t,dataType:"json",success:function(n){if(Common.ShowLoading(!1),!Common.Empty(n))if(n.status===!0){var t=n.data[0].CookieId;Common.createCookie("orderCart",n.data[0].CookieId,1);Common.createCookie(t,JSON.stringify(n.data),1);toastr.success("Thêm vào giỏ hàng thành công.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0});window.location.href=Common.CartAdd.Url.CartIndex}else toastr.error("Thêm vào giỏ hàng thất bại.!!!","Thông báo",{timeOut:2e3,progressBar:!0,closeButton:!0})},error:function(){}})),!1});$('input[data-key="inp-Offer"]').unbind("click").change(function(){var r,n,i;if($('input[data-key="inp-Offer"]:checked').length===2)return $('input[data-key="inp-Offer"]').not(":checked").prop("disabled",!0),!1;$('input[data-key="inp-Offer"]').not(":checked").prop("disabled",!1);r=$(this).val();n=$(this).closest("tr").attr("data-key");let t=$(this).attr("data-promotionid");$(this).is(":checked")?($('input[inp-key="'+n+'"]').not(":checked").prop("disabled",!0),$('tr[data-isapply="false"]').each(function(){$(this).find("input").prop("disabled",!0)}),$('input[data-promotionid="'+t+'"]').not(":checked").prop("disabled",!0),i=$(this).closest("tr").attr("data-isapply"),i==="False"&&$('input[data-key="inp-Offer"]').not(":checked").prop("disabled",!0)):($('input[inp-key="'+n+'"]').not(":checked").prop("disabled",!1),$('input[data-promotionid="'+t+'"]').not(":checked").prop("disabled",!1),$('input[data-key="inp-Offer"]').not(":checked").prop("disabled",!1))})},validatorForm:n=>{document.querySelectorAll(n+" .field-validation-error").forEach(function(n){n.parentNode.removeChild(n)}),document.querySelectorAll(n+' input[type="text"][data-rule-required],'+n+' textarea[data-rule-required="true"]').forEach(function(n){if(Common.Empty(n.value)&&Common.Empty(n.getAttribute("disabled"))){var t='<div class="field-validation-error alert alert-danger fade show" role="alert" style="display: block;">'+n.getAttribute("data-msg-required")+"<\/div>";n.parentNode.insertAdjacentHTML("beforeend",t)}}),document.querySelectorAll(n+' input[type="text"][data-rule-email]').forEach(function(n){if(!Common.Empty(n.value)&&!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(n.value)&&Common.Empty(n.getAttribute("disabled"))){var t='<div class="field-validation-error alert alert-danger fade show" role="alert" style="display: block;">'+n.getAttribute("data-msg-email")+"<\/div>";n.parentNode.insertAdjacentHTML("beforeend",t)}}),document.querySelectorAll(n+' input[type="file"][data-rule-required]').forEach(function(n){if(Common.Empty(n.value)){var t='<div class="field-validation-error alert alert-danger fade show" role="alert" style="display: block;">'+n.getAttribute("data-msg-required")+"<\/div>";n.parentNode.insertAdjacentHTML("beforeend",t)}})}};